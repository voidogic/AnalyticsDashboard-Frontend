<div class="admin-users-container">
  <div class="page-header">
    <h1>User Management</h1>
    <p class="subtitle">Manage all system users and their roles</p>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="Search by name or email..." 
        [(ngModel)]="searchQuery"
        (keyup)="onSearch()"
        class="search-input"
      >
    </div>

    <div class="filters">
      <select 
        [(ngModel)]="roleFilter"
        (change)="onRoleFilterChange()"
        class="filter-select"
      >
        <option value="">All Roles</option>
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>

      <select 
        [(ngModel)]="statusFilter"
        (change)="onStatusFilterChange()"
        class="filter-select"
      >
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>

    <button (click)="openModal()" class="btn-primary">
      <span>+</span> Add New User
    </button>
  </div>

  <!-- Users Table -->
  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Created</th>
          <th>Last Login</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" [class.inactive]="!user.isActive">
          <td class="user-name">{{ user.fullName }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="'role-' + user.role">
              {{ user.role | uppercase }}
            </span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="user.isActive ? 'status-active' : 'status-inactive'">
              {{ user.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>{{ user.createdAt }}</td>
          <td>{{ user.lastLogin }}</td>
          <td class="actions">
            <button (click)="editUser(user)" class="btn-icon btn-edit" title="Edit">
              ✎
            </button>
            <button (click)="toggleUserStatus(user)" class="btn-icon btn-toggle" title="Toggle Status">
              ⟲
            </button>
            <button (click)="deleteUser(user._id)" class="btn-icon btn-delete" title="Delete">
              ✕
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredUsers.length === 0" class="no-data">
      No users found
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="isModalOpen" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit User' : 'Add New User' }}</h2>
        <button class="btn-close" (click)="closeModal()">×</button>
      </div>

      <form [formGroup]="form" (ngSubmit)="saveUser()" class="modal-form">
        <div class="form-group">
          <label>Full Name</label>
          <input 
            type="text" 
            formControlName="fullName" 
            class="form-input"
            placeholder="Enter full name"
          >
          <span class="error" *ngIf="form.get('fullName')?.hasError('required') && form.get('fullName')?.touched">
            Full name is required
          </span>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input 
            type="email" 
            formControlName="email" 
            class="form-input"
            placeholder="Enter email"
          >
          <span class="error" *ngIf="form.get('email')?.hasError('email') && form.get('email')?.touched">
            Valid email is required
          </span>
        </div>

        <div class="form-group">
          <label>Role</label>
          <select formControlName="role" class="form-input">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div class="form-group checkbox">
          <input 
            type="checkbox" 
            formControlName="isActive" 
            id="isActive"
          >
          <label for="isActive">Active</label>
        </div>

        <div class="modal-actions">
          <button type="button" (click)="closeModal()" class="btn-secondary">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="form.invalid">
            {{ isEditMode ? 'Update' : 'Create' }} User
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
